<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flower DNA Resonance</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .ui-container {
            position: relative;
            z-index: 10;
            text-align: center;
            pointer-events: none;
            text-shadow: 0 0 10px rgba(0,0,0,0.8);
        }

        #display {
            font-size: 14px;
            letter-spacing: 2px;
            opacity: 0.8;
            margin-bottom: 20px;
        }

        #startBtn {
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: white;
            cursor: pointer;
            pointer-events: auto;
            backdrop-filter: blur(5px);
            border-radius: 30px;
            transition: 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #startBtn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.5;
            animation: twinkle var(--duration) infinite;
        }

        .aura {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            z-index: 0;
            opacity: 0.4;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>

    <div class="ui-container">
        <div id="display">ОЧІКУВАННЯ СИГНАЛУ...</div>
        <button id="startBtn">Активувати резонанс</button>
    </div>

    <canvas id="flowerCanvas"></canvas>

    <script>
        const canvas = document.getElementById('flowerCanvas');
        const ctx = canvas.getContext('2d');
        const startBtn = document.getElementById('startBtn');
        const display = document.getElementById('display');
        
        // 1. Отримання параметрів та приведення до нижнього регістру
        const urlParams = new URLSearchParams(window.location.search);
        const hue = parseInt(urlParams.get('hue')) || 280;
        const petalsCount = parseInt(urlParams.get('petals')) || 8;
        const ip = urlParams.get('ip') || "0.0.0.0";
        const resonanceFreq = parseInt(urlParams.get('freq')) || 432;
        const rawElement = urlParams.get('element') || "water";
        const element = rawElement.toLowerCase().trim();

        // Оновлюємо текст
        display.innerText = `IP: ${ip} | ELEMENT: ${element.toUpperCase()}`;

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Конфігурація стихій (кольорів фону та швидкості)
        const elementStyles = {
            "fire":  { h: 15,  s: 90, l: 50, speed: 0.04 },
            "earth": { h: 130, s: 40, l: 30, speed: 0.015 },
            "air":   { h: 200, s: 80, l: 70, speed: 0.05 },
            "water": { h: 220, s: 70, l: 40, speed: 0.02 }
        };

        const style = elementStyles[element] || elementStyles.water;

        // Створення зірок та аури стихії
        function initBackground() {
            // Зірки
            for (let i = 0; i < 80; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 2;
                star.style.width = star.style.height = `${size}px`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.setProperty('--duration', `${2 + Math.random() * 4}s`);
                document.body.appendChild(star);
            }

            // Аура стихії (фон)
            for (let i = 0; i < 3; i++) {
                const aura = document.createElement('div');
                aura.className = 'aura';
                const size = 400 + Math.random() * 300;
                aura.style.width = aura.style.height = `${size}px`;
                aura.style.left = `${Math.random() * 60 - 10}%`;
                aura.style.top = `${Math.random() * 60 - 10}%`;
                aura.style.background = `radial-gradient(circle, hsla(${style.h}, ${style.s}%, ${style.l}%, 0.3) 0%, transparent 70%)`;
                document.body.appendChild(aura);
            }
        }

        let time = 0;

        function drawFlower() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const cx = canvas.width / 2;
            const cy = canvas.height / 2;

            ctx.save();
            ctx.translate(cx, cy);

            for (let i = 0; i < petalsCount; i++) {
                ctx.rotate((Math.PI * 2) / petalsCount);
                
                ctx.beginPath();
                const len = 150 + Math.sin(time * 2 + i) * 30;
                
                const grad = ctx.createLinearGradient(0, 0, 0, len);
                grad.addColorStop(0, `hsla(${hue}, 100%, 70%, 0)`);
                grad.addColorStop(0.5, `hsla(${hue}, 100%, 70%, 0.8)`);
                grad.addColorStop(1, `hsla(${hue}, 100%, 70%, 0)`);

                ctx.strokeStyle = grad;
                ctx.lineWidth = 3;
                ctx.moveTo(0, 0);
                ctx.quadraticCurveTo(40, len / 2, 0, len);
                ctx.stroke();
            }

            ctx.restore();
            time += style.speed;
            requestAnimationFrame(drawFlower);
        }

        function playSound() {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                const audioCtx = new AudioContext();
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                
                osc.frequency.setValueAtTime(resonanceFreq, audioCtx.currentTime);
                gain.gain.setValueAtTime(0, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0.1, audioCtx.currentTime + 1);
                
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start();
            } catch(e) { console.log("Audio API not supported"); }
        }

        startBtn.addEventListener('click', () => {
            playSound();
            startBtn.style.display = 'none';
        });

        initBackground();
        drawFlower();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
