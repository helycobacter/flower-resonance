<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; background: #000; overflow: hidden; height: 100vh; display: flex; align-items: center; justify-content: center; }
        canvas { position: absolute; top: 0; left: 0; }
        #ui { position: absolute; z-index: 10; bottom: 30px; text-align: center; width: 100%; pointer-events: none; }
        #startBtn { pointer-events: auto; padding: 12px 30px; background: none; border: 1px solid rgba(255,255,255,0.3); color: #fff; border-radius: 30px; cursor: pointer; backdrop-filter: blur(5px); font-family: sans-serif; letter-spacing: 1px; }
    </style>
</head>
<body>
    <div id="ui"><button id="startBtn">ACTIVATE RESONANCE</button></div>
    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const params = new URLSearchParams(window.location.search);
        
        const hue = parseInt(params.get('hue')) || 280;
        const petals = parseInt(params.get('petals')) || 8;
        const freq = parseInt(params.get('freq')) || 432;
        const element = (params.get('element') || "water").toLowerCase();

        const styles = {
            fire:  { h: 10,  s: 100, l: 40, speed: 0.03 },
            earth: { h: 125, s: 50,  l: 30, speed: 0.01 },
            air:   { h: 195, s: 70,  l: 60, speed: 0.04 },
            water: { h: 225, s: 60,  l: 40, speed: 0.015 }
        };
        const stl = styles[element] || styles.water;

        let w, h;
        function resize() {
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        let t = 0;

        function drawPetal(len, width, angle, color, alpha) {
            ctx.save();
            ctx.rotate(angle);
            ctx.beginPath();
            
            // Ефект світіння
            ctx.shadowBlur = 15;
            ctx.shadowColor = color;
            ctx.globalAlpha = alpha;
            
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            
            // Малюємо форму пелюстки через дві криві Безьє
            ctx.moveTo(0, 0);
            ctx.bezierCurveTo(width, len/3, width, len*2/3, 0, len);
            ctx.bezierCurveTo(-width, len*2/3, -width, len/3, 0, 0);
            
            ctx.stroke();
            
            // Додаємо внутрішню "жилку" пелюстки
            ctx.beginPath();
            ctx.lineWidth = 1;
            ctx.moveTo(0, 0);
            ctx.lineTo(0, len * 0.8);
            ctx.stroke();
            
            ctx.restore();
        }

        function draw() {
            // Фон з глибокою аурою
            const grd = ctx.createRadialGradient(w/2, h/2, 0, w/2, h/2, w*0.8);
            grd.addColorStop(0, `hsla(${stl.h}, ${stl.s}%, 10%, 1)`);
            grd.addColorStop(1, "#000");
            ctx.fillStyle = grd;
            ctx.fillRect(0, 0, w, h);

            ctx.save();
            ctx.translate(w/2, h/2);
            
            // Плавне хитання всієї квітки
            ctx.translate(Math.cos(t*0.5)*10, Math.sin(t*0.5)*10);
            ctx.rotate(t * 0.1);

            // Малюємо 3 шари пелюсток для об'єму
            for (let layer = 0; layer < 3; layer++) {
                const layerScale = 1 - layer * 0.2;
                const layerAlpha = 0.8 - layer * 0.2;
                const layerLen = (180 + Math.sin(t + layer) * 20) * layerScale;
                const layerWidth = 60 * layerScale;

                for (let i = 0; i < petals; i++) {
                    const angle = (Math.PI * 2 / petals) * i + (layer * 0.2);
                    const petalHue = (hue + layer * 15) % 360;
                    drawPetal(layerLen, layerWidth, angle, `hsla(${petalHue}, 100%, 75%, 1)`, layerAlpha);
                }
            }

            ctx.restore();

            t += stl.speed;
            requestAnimationFrame(draw);
        }

        document.getElementById('startBtn').onclick = (e) => {
            e.target.style.display = 'none';
            const ac = new (window.AudioContext || window.webkitAudioContext)();
            const o = ac.createOscillator();
            const g = ac.createGain();
            o.frequency.value = freq;
            g.gain.setValueAtTime(0, ac.currentTime);
            g.gain.linearRampToValueAtTime(0.1, ac.currentTime + 2);
            o.connect(g); g.connect(ac.destination);
            o.start();
        };

        draw();
    </script>
</body>
</html>
