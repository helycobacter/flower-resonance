<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        /* Пряме керування фоном через CSS для надійності */
        body { 
            margin: 0; 
            padding: 0;
            background: #000; 
            color: #fff; 
            font-family: sans-serif; 
            overflow: hidden; 
            height: 100vh; 
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: center;
        }
        canvas { position: absolute; top: 0; left: 0; z-index: 1; }
        #ui { position: relative; z-index: 10; text-align: center; pointer-events: none; }
        #startBtn { 
            pointer-events: auto; 
            padding: 15px 30px; 
            background: #fff; 
            color: #000; 
            border: none;
            border-radius: 25px; 
            font-weight: bold;
            cursor: pointer;
        }
        #display { margin-bottom: 20px; font-size: 16px; font-weight: bold; text-shadow: 2px 2px 4px #000; }
    </style>
</head>
<body>
    <div id="ui">
        <div id="display">LOADING DNA...</div>
        <button id="startBtn">START RESONANCE</button>
    </div>
    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const params = new URLSearchParams(window.location.search);
        
        // Отримуємо параметри
        const hue = parseInt(params.get('hue')) || 280;
        const petals = parseInt(params.get('petals')) || 8;
        const ip = params.get('ip') || "0.0.0.0";
        const element = (params.get('element') || "water").toLowerCase();

        // Проста логіка кольорів
        const colors = {
            fire: { h: 10,  label: "FIRE" },
            earth: { h: 120, label: "EARTH" },
            air: { h: 200, label: "AIR" },
            water: { h: 225, label: "WATER" }
        };
        const config = colors[element] || colors.water;

        // Встановлюємо фон через JS прямо на Body для гарантії
        document.body.style.background = `radial-gradient(circle at center, hsla(${config.h}, 80%, 20%, 1) 0%, #000 80%)`;
        document.getElementById('display').innerText = `IP: ${ip} | ${config.label}`;

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let t = 0;
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Чистимо повністю
            ctx.save();
            ctx.translate(canvas.width/2, canvas.height/2);
            
            for(let i=0; i < petals; i++) {
                ctx.rotate((Math.PI * 2) / petals);
                ctx.beginPath();
                let len = 150 + Math.sin(t + i) * 30;
                
                // Малюємо яскраву лінію
                ctx.strokeStyle = `hsla(${hue}, 100%, 70%, 0.9)`;
                ctx.lineWidth = 5;
                ctx.lineCap = 'round';
                ctx.moveTo(0, 0);
                ctx.quadraticCurveTo(40, len/2, 0, len);
                ctx.stroke();
            }
            ctx.restore();
            t += 0.03;
            requestAnimationFrame(draw);
        }

        document.getElementById('startBtn').onclick = () => {
            document.getElementById('ui').style.display = 'none';
            // Звук
            try {
                const ac = new (window.AudioContext || window.webkitAudioContext)();
                const o = ac.createOscillator();
                const g = ac.createGain();
                o.frequency.value = parseInt(params.get('freq')) || 432;
                g.gain.value = 0.1;
                o.connect(g); g.connect(ac.destination);
                o.start();
            } catch(e) {}
        };

        draw();
    </script>
</body>
</html>
